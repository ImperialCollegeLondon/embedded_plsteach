{% extends 'base.html' %}

{% block content %}

<html>
    <head>
        <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/test.css') }}">
                <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
                <script type="text/javascript" src="//cdn.bootcss.com/socket.io/1.5.1/socket.io.min.js"></script>
                </head>
    <body>
<div class="col-12">
    <div class="page-header row no-gutters py-4">
        <div class="col-12 col-sm-4 text-center text-sm-left mb-0">
            <h3 class="page-title">Real-time {% block title %}Graph{% endblock %}</h3>
        </div>
    </div>
    <div class="col-12">
<div class="row">
    <div style="width: 1050px">
        <div class="card card-small">
            <div class="card-header" >
                <p></p>
            </div>
            <div class="card-body pt-0">
                <div id="chart_area" class="test">
                    <canvas id="raw_chart"></canvas>
                    <button class="btn btn-sm btn-outline-accent">Play</button>
                </div>
                <div class="test">
                    <canvas id="proc_chart"></canvas>
                </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>

        <script>
        var socket = io.connect('http://localhost:5000');
        playing = false;
        interval = null;
        var data = [[{}],[],[],[]];
    	var color = ["rgba(231,115,115,50)","rgba(115,173,231,50)",
                	"rgba(115,231,115,50)","rgba(231,173,115,50)"]
        var pedal1 = new Image();
        pedal1.src = 'https://i.imgur.com/yDYW1I7.png';
        var pedal2 = new Image();
        pedal2.src = 'https://i.imgur.com/DIbr9q1.png';

		var config = {
			type: 'line',
			data: {
				datasets: []
			},
			options: {
				responsive: true,
				title: {
					display: true,
					text: 'Sensor Data Plot'
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Time'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Value'
						}
					}]
				}
			}
		};

         window.onload = function() {
			var ctx = document.getElementById('raw_chart').getContext('2d');
			window.rawCh = new Chart(ctx, config);
			addDataSet();
		};

          socket.on('data_in', function(msg){
            data[0].push({x:msg.x, y:msg.y});
        });

         function updateChart() {
            window.rawCh.update();
         }

         function addDataSet() {
    		var sen_num = config.data.datasets.length;
			var newDataset = {
				label: 'Sensor ' + (sen_num+1),
				backgroundColor: color[sen_num],
				borderColor: color[sen_num],
				data: data[sen_num],
				fill: false
				};
			config.data.datasets.push(newDataset);
			window.rawCh.update();
		};

         function simplify() {
    		window.rawCh.config.data.datasets[0]._meta[0].data[0]._model.pointStyle = pedal1;
    	 }

          $("#chart_area button").on('click', function(e) {
                                 if (playing) {
                                 $(e.target).text('Play');
                                 clearInterval(interval);
                                 socket.emit('stop_transmit')
                                 }
                                 else {
                                 $(e.target).text('Pause');
                                 socket.emit('start_transmit')
                                 interval = setInterval(updateChart, 100);
                                 updateChart();
                                 }
                                 playing = !playing;
                                 });

            </script>

    </body>
</html>

{% endblock %}
